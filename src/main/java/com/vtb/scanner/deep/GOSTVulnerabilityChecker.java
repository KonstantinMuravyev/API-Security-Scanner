package com.vtb.scanner.deep;

import com.vtb.scanner.models.Severity;
import com.vtb.scanner.models.Vulnerability;
import com.vtb.scanner.models.VulnerabilityType;
import io.swagger.v3.oas.models.OpenAPI;
import lombok.extern.slf4j.Slf4j;

import java.util.ArrayList;
import java.util.List;

/**
 * Проверка уязвимостей в ГОСТ системах
 */
@Slf4j
public class GOSTVulnerabilityChecker {
    
    /**
     * Найти уязвимости ГОСТ
     */
    public static List<Vulnerability> findGOSTVulnerabilities(OpenAPI openAPI) {
        List<Vulnerability> vulnerabilities = new ArrayList<>();
        
        if (openAPI == null) {
            return vulnerabilities;
        }
        
        // Проверка на упоминание ГОСТ в описании
        String description = openAPI.getInfo() != null && 
            openAPI.getInfo().getDescription() != null ?
            openAPI.getInfo().getDescription().toLowerCase() : "";
        
        boolean mentionsGOST = description.contains("гост") || 
                               description.contains("gost") ||
                               description.contains("34.10") ||
                               description.contains("34.11");
        
        if (mentionsGOST) {
            // Проверяем на наличие устаревших ГОСТ
            if (description.contains("28147-89") || description.contains("gost28147")) {
                vulnerabilities.add(Vulnerability.builder()
                    .id("GOST-OUTDATED-28147")
                    .type(VulnerabilityType.GOST_VIOLATION)
                    .severity(Severity.MEDIUM)
                    .title("Использование устаревшего ГОСТ 28147-89")
                    .description("Упоминается ГОСТ 28147-89, который устарел. Рекомендуется ГОСТ Р 34.12-2015")
                    .endpoint("N/A")
                    .method("N/A")
                    .recommendation("Используйте ГОСТ Р 34.12-2015 (Кузнечик/Магма)")
                    .owaspCategory("Russian Standards - GOST")
                    .evidence("Упоминание ГОСТ 28147-89 в описании")
                    .gostRelated(true)
                    .build());
            }
        }
        
        return vulnerabilities;
    }
}

